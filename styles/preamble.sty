\usepackage[main=russian,english]{babel} % Русский язык
\usepackage[no-math]{fontspec}  % Что-то для поддержки шрифтов
\usepackage{geometry} % Настройка формата отдельных элементов
\usepackage[dvips,xetex]{graphicx} % Поддержка графики
\usepackage{fancyhdr} % Настройка колонтитулов
\usepackage[subpreambles=true]{standalone} % Поддержка нескольких tex-файлов
\usepackage{import} % Имортирование tex файлов
\usepackage[pages=some]{background} % Вставка изображений на задний фон
\usepackage{xcolor} % Поддержка разных цветов
\usepackage{minted} % Вставка кода
\usepackage{amsmath} % Математические символы
\usepackage{amsfonts} % Шрифты для математики
\usepackage{amssymb} % Больше математических символов
\usepackage{amsthm} % Нумерация теорем
\usepackage{caption} % Подпись к чему-то
\usepackage{hyperref} % Вставка ссылок и их раскрасска
\usepackage{xurl} % Красивая вставка ссылок
\usepackage{indentfirst} % Делать отступы для первых абзацев тоже
\usepackage{multicol} % Объединение столбцов для для таблиц
\usepackage[shortlabels]{enumitem} % Для красивой нумерации
\usepackage{csvsimple} % Вставка простых табличек
\usepackage{pgfplotstable} % Вставка сложных табличек
\usepackage{ulem} % Для подчёркиваний и перечёркиваний текста
\usepackage{algorithm}
\usepackage{algpseudocode} % Для красивого оформления псевдокода

% Устанавливаем нужные шрифты
\setmainfont{Raleway}[
	Extension = .ttf,
	UprightFont = fonts/Raleway/*-Regular,
	ItalicFont = fonts/Raleway/*-Italic,
	BoldFont = fonts/Raleway/*-Bold,
	BoldItalicFont = fonts/Raleway/*-Bold-Italic,
]
\setmonofont{AnonymousPro}[
	Extension = .ttf,
	UprightFont = fonts/AnonymousPro/*-Regular,
	ItalicFont = fonts/AnonymousPro/*-Italic,
	BoldFont = fonts/AnonymousPro/*-Bold,
	BoldItalicFont = fonts/AnonymousPro/*-Bold-Italic,
]

% Формируем размеры документа и отступы
\geometry{
	a4paper,
	total={170mm,257mm},
	left=20mm,
	top=20mm
}

% Рамка для титульника
\backgroundsetup{
	scale=1.0,
	color=black,
	opacity=0.4,
	angle=0,
	contents={%
		\includegraphics[width=0.9\paperwidth,height=0.929\paperheight]{pic/border}
	}%
}

% Настройка цвета
\definecolor{LightGray}{gray}{0.98}

% Перевод листинга на русский
\renewcommand{\listingscaption}{Листинг}

% Разукрашивание сыслок
\hypersetup{
    colorlinks=true,
    linkcolor=teal,
    filecolor=purple,
    urlcolor=blue,
}

% \lst вставляет код из файла, где
% первый аргумент -- язык, второй -- имя файла
\newcommand{\lst}[2] {
	\inputminted[
		fontfamily=tt,              % шрифт
		numberblanklines=true,      % нумерация пустых строк
		numbersep=5pt,              % расстояние между нумерацией и кодом
		frame=leftline,             % вертикальная фрейм слева от кода
		framerule=0.4pt,            % ширина фрейма
		framesep=2mm,               % расстояние между фреймом и кодом
		funcnamehighlighting=true,  % только для PHP
		tabsize=2,                  % количество пробелов в табуляции
		breaklines=true,            % перенос строк
		linenos=true,               % нумерация строк
		breakanywhere=true,         % разрывы для длинных строк
		%bgcolor=LightGray,         % цвет фона
		fontsize=\footnotesize,     % размер используемого шрифта
	]{#1}{#2}
}

% Стили для секции с примечанием
\tikzstyle{mybox} = [draw=black, very thick,
    rectangle, inner sep=13pt, inner ysep=15pt]
\tikzstyle{fancytitle} = [fill=white, text=black]

% \fblock -- подписанный и обрамлённый рамкой блок текста
% первый аргумент -- подпись
% второй аргумент -- собственно текст
\newcommand{\reference}[2]{%
\noindent
\begin{tikzpicture}
\node [mybox] (box){%
    \begin{minipage}{0.938\textwidth}
    #2
    \end{minipage}
};
\node[fancytitle, right=10pt] at (box.north west) {\textbf{#1}};
\end{tikzpicture}%
}

% \todo принимает в качестве аргумента описание проблемы
\newcommand{\todo}[1]{%
\textcolor{red}{\textit{\underline{TODO.} #1}}
}

% Шрифты для собственной математики
\DeclareMathAlphabet{\mathsfn}{OT1}{OMS}{m}{n}

\newcommand{\der}{\partial} % Символ дифференцирования
\newcommand{\divr}{\, \mathsfn{div} \,} % Дивергенция
\newcommand{\grad}{\, \mathsfn{grad} \,} % Градиент
\newcommand{\determinant}{\, \mathsfn{det} \,} % Определитель

% \mtext принимает текст в качестве аргумента.
% используется для вставки слов в математические формулы
\newcommand{\mtext}[1] {
	\, \text{#1} \,
}

% \Int большой интеграл (область правее знака интеграла)
\newcommand{\Int} {
	\displaystyle\int
}

% \INT очень большой интеграл (промежуток над и под знаком интеграла)
\newcommand{\INT} {
	\displaystyle\int\limits
}

% \Sum большая сумма (информация о сумме правее её знака)
\newcommand{\Sum} {
	\displaystyle\sum
}

% \SUM очень большая сумма (информация о сумме под и над её знаком)
\newcommand{\SUM} {
	\displaystyle\sum\limits
}

% Имитация малых прописных (small caps), \fauxsc{что-то}
% взято отсюда: https://tex.stackexchange.com/questions/55664/fake-small-caps-with-xetex-fontspec/225078#225078
\makeatletter
\newlength\fake@f
\newlength\fake@c
\def\fakesc#1{%
  \begingroup%
  \xdef\fake@name{\csname\curr@fontshape/\f@size\endcsname}%
  \fontsize{\fontdimen8\fake@name}{\baselineskip}\selectfont%
  \uppercase{#1}%
  \endgroup%
}
\makeatother
\newcommand\fauxsc[1]{\fauxschelper#1 \relax\relax}
\def\fauxschelper#1 #2\relax{%
  \fauxschelphelp#1\relax\relax%
  \if\relax#2\relax\else\ \fauxschelper#2\relax\fi%
}
\def\Hscale{.83}\def\Vscale{.72}\def\Cscale{1.00}
\def\fauxschelphelp#1#2\relax{%
  \ifnum`#1=\lccode`#1\relax\scalebox{\Hscale}[\Vscale]{\char\uccode`#1}\else%
    \scalebox{\Cscale}[1]{#1}\fi%
  \ifx\relax#2\relax\else\fauxschelphelp#2\relax\fi}